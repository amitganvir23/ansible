---
- hosts: win
  gather_facts: no
  tasks:
  - name: Creating A directory
    win_file:
      path: C:\Amit\app
      state: directory

  - name: Creating a empty file
    win_file:
      path: C:\Amit\app/index.html
      state: touch

  - name: Install IIS (Web-Server only)
    win_feature:
      name: Web-Server
      state: present

  - name: Install IIS (Web-Server and Web-Common-Http)
    win_feature:
      name:
      - Web-Server
      - Web-Common-Http
      state: present

      #  - name: Install NET-Framework-Core from file
      #win_feature:
      # name: NET-Framework-Core
      #    source: C:\Temp\iso\sources\sxs
      # state: present

  - name: Install IIS Web-Server with sub features and management tools
    win_feature:
      name: Web-Server
      state: present
      include_sub_features: yes
      include_management_tools: yes
    register: win_feature

  - name: Reboot if installing Web-Server feature requires it
    win_reboot:
    when: win_feature.reboot_required

  - name: Copy folder contents recursively
    win_copy:
      src: raj
      dest: C:\inetpub\wwwroot
 ######### 7zip    ######### 
  - name: Checking 7zip file
    win_stat:
      path: C:\7zip.msi
    register: stat_file

  - name: Download 7zip
    win_get_url:
      url: http://7-zip.org/a/7z1604-x64.msi
      dest: C:\7zip.msi
    when: stat_file.stat.exists == False

  - name: Check if 7-Zip is already installed
    win_stat: path='C:\Program Files\7-Zip\7z.exe'
    register: zip_installed

  - name: Install 7zip
    win_package:
      path: C:\7zip.msi
      creates_path: C:\Program Files\7-Zip\7z.exe
      state: present
    when: zip_installed.stat.exists == False

######### Redis #########
  - name: Checking redis file
    win_stat:
      path: C:\redis.msi
    register: stat_file

  - name: Download redis
    win_get_url:
      url: https://github.com/microsoftarchive/redis/releases/download/win-2.8.2104/Redis-x64-2.8.2104.msi
      dest: C:\redis.msi
    when: stat_file.stat.exists == False
    
  - name: Check if Redis is already installed
    win_stat: path='C:\Program Files\Redis\redis-server.exe'
    register: zip_installed

  - name: Install 7zip
    win_package:
      path: C:\redis.msi
      state: present
    when: zip_installed.stat.exists == False

